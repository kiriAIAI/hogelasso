<!DOCTYPE html>
<html data-wf-page="670b7401d43d7adda246babe" data-wf-site="670b6ec91824c1500bdac7a2">
<head>
  <meta charset="utf-8">
  <title>create</title>
  <meta content="create" property="og:title">
  <meta content="create" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="{{ url_for('static', filename='css/normalize.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/webflow.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/kakikko2.webflow.css') }}" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Noto Sans JP:regular,500,600,700,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="{{ url_for('static', filename='images/favicon.png') }}" rel="shortcut icon" type="image/x-icon">
  <link href="{{ url_for('static', filename='images/webclip.png') }}" rel="apple-touch-icon">
</head>
<body class="body">
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
    <div class="navbar-container">
      <a href="{{ url_for('index') }}" aria-current="page" class="w-nav-brand w--current">
        <img loading="lazy" src="{{ url_for('static', filename='images/Logo.png') }}" alt="LOGO">
      </a>
      <div class="navbar-menu-wrapper">
        <nav role="navigation" class="nav-menu w-nav-menu">
          <div data-delay="0" data-hover="false" class="w-dropdown">
            <div class="dropdown-toggle w-dropdown-toggle">
              <div class="bell-icon">
                <img src="{{ url_for('static', filename='images/bell.svg') }}" loading="lazy" alt="" class="navbar-icon">
              </div>
            </div>
            <nav class="dropdown-list w-dropdown-list">
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
            </nav>
          </div>
          <a href="{{ url_for('shoppingcart') }}" class="navbar-link shopping-cart w-nav-link"><img src="{{ url_for('static', filename='images/cart-shopping.svg') }}" loading="lazy" alt="" class="navbar-icon"></a>
          <a href="{{ url_for('login') }}" class="navbar-link w-nav-link"><img src="{{ url_for('static', filename='images/user-login.svg') }}" loading="lazy" alt="" class="navbar-icon"></a>
        </nav>
        <div class="menu-button w-nav-button">
          <div class="hamburger-menu w-icon-nav-menu"></div>
        </div>
      </div>
    </div>
  </div>
  <section class="hero-section">
    <div class="w-layout-blockcontainer hero-container w-container">
      <div class="sidenavbar">
        <div class="sindnavbar-header">
          <div class="sidenavbar-top">
            <a href="#" class="square is--hamburger w-inline-block">
              <img loading="lazy" src="{{ url_for('static', filename='images/hamburger.svg') }}" alt="" class="navbar__icon is--1">
              <img loading="lazy" src="{{ url_for('static', filename='images/x.svg') }}" alt="" class="navbar__icon is--2">
            </a>
          </div>
          <a href="{{ url_for('filter') }}" class="sidenavbar-search w-inline-block">
            <div class="square is--search"><img loading="lazy" src="{{ url_for('static', filename='images/search.svg') }}" alt="" class="navbar__icon is--search"></div>
            <div class="hide-text">
              <p class="sidenavbar-paragraph">検索</p>
            </div>
          </a>
          <div class="square is--line"></div>
        </div>
        <div class="nav__links">
          <a href="{{ url_for('index') }}" aria-current="page" class="sidenavbar-link w-inline-block w--current">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/home.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">ホーム</p>
            </div>
          </a>
          <a href="{{ url_for('create') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/plus.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">作成</p>
            </div>
          </a>
          <a href="{{ url_for('chatroom') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/chat.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">チャット</p>
            </div>
          </a>
          <a href="{{ url_for('purchase_history') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/history.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">購入履歴</p>
            </div>
          </a>
          <a href="{{ url_for('profile') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/user.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">プロフィール</p>
            </div>
          </a>
        </div>
        <div class="nav__footer">
          <a href="{{ url_for('confirmlogout') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/logout.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">ログアウト</p>
            </div>
          </a>
        </div>
      </div>
      <div class="create-block">
        <div class="create-left-block">
          <div id="textForm" class="create-form-block w-form">
            <form id="wf-form-Create-Form" name="wf-form-Create-Form" data-name="Create Form" method="POST" class="create-form" data-wf-page-id="670b7401d43d7adda246babe" data-wf-element-id="8c65cdfb-f7bb-bff4-037b-43b70214289f">
              <label for="titleInput" class="create-form-label">タイトル</label>
              <input class="create-form-field w-input" maxlength="256" name="title" data-name="title" type="text" id="titleInput" contenteditable="true" required>
              <label for="contentInput" class="create-form-label">内容</label>
              <textarea class="textarea w-input" maxlength="5000" name="content" data-name="content" id="contentInput" contenteditable="true" required></textarea>
              <input type="submit" data-wait="Please wait..." class="post-btn w-button" value="投稿">
            </form>
          </div>
        </div>
        <div class="create-right-block">
          <div class="editor-form-block w-form">
            <div class="color-picker-block">
              <h4 class="font-editor-heading">色選択</h4>
              <div class="color-picker-container">
                <input type="color" id="colorPicker" value="#ff0000" oninput="updateColorValue(this.value)">
                <div class="color-display">
                  <div class="color-swatch" id="swatch"></div>
                  <span class="color-value" id="hexValue">#ff0000</span>
                  <span class="dropdown-arrow"></span>
                </div>
              </div>
            </div>
            <div class="fontsize-block">
              <h4 class="font-editor-heading">フォントサイズ</h4>
              <div class="fontsize-adjuster">
                <button class="fontsize-btn">−</button>
                <input type="number" id="sizeInput" class="fontsize-input" value="1" step="0.1" min="0.5" max="5">
                <button class="fontsize-btn">+</button>
              </div>
            </div>
          </div>
          <div class="font-style-block">
            <h4 class="font-heading">フォント</h4>
            <div class="font-style-wrapper">
              <button id="boldBtn" class="font-btn w-node-_6db278e6-56f0-8372-7584-187d05b3c428-a246babe w-button" onclick="formatDoc('bold')"><i class="fa-solid fa-bold"></i></button>
              <button id="italicBtn" class="font-btn w-node-_6db278e6-56f0-8372-7584-187d05b3c42a-a246babe w-button" onclick="formatDoc('italic')"><i class="fa-solid fa-italic"></i></button>
              <button id="underlineBtn" class="font-btn w-node-_6db278e6-56f0-8372-7584-187d05b3c42c-a246babe w-button" onclick="formatDoc('underline')"><i class="fa-solid fa-underline"></i></button>
            </div>
          </div>
          <div class="text-alignment-block">
            <h4 class="font-heading">段落</h4>
            <div class="font-style-wrapper">
              <button id="alignLeftBtn" class="font-btn w-node-_3968feec-64d2-33e6-f936-3ceaddd2442b-a246babe w-button" onclick="formatDoc('justifyLeft')"><i class="fa-solid fa-align-left"></i></button>
              <button id="alignCenterBtn" class="font-btn w-node-_3968feec-64d2-33e6-f936-3ceaddd2442d-a246babe w-button" onclick="formatDoc('justifyCenter')"><i class="fa-solid fa-align-center"></i></button>
              <button id="alignRightBtn" class="font-btn w-node-_3968feec-64d2-33e6-f936-3ceaddd2442f-a246babe w-button" onclick="formatDoc('justifyRight')"><i class="fa-solid fa-align-right"></i></button>
            </div>
          </div>
          <div class="list-controls-block">
            <h4 class="font-heading">項目</h4>
            <div class="font-style-wrapper">
              <button id="bulletListBtn" class="font-btn w-node-_77dac16e-7799-7813-43e7-2438d665b16a-a246babe w-button" onclick="insertList('insertUnorderedList')"><i class="fa-solid fa-list-ul"></i></button>
              <button id="numberedListBtn" class="font-btn w-node-_77dac16e-7799-7813-43e7-2438d665b16c-a246babe w-button" onclick="insertList('insertOrderedList')"><i class="fa-solid fa-list-ol"></i></button>
              <button id="checkboxListBtn" class="font-btn w-node-_77dac16e-7799-7813-43e7-2438d665b16e-a246babe w-button" onclick="insertCheckbox()"><i class="fa-solid fa-list-check"></i></button>
            </div>
          </div>
          <div class="create-category-block">
            <h4 class="create-category-heading">カテゴリ</h4>
            <select id="categorySelect" name="categorySelect" data-name="categorySelect" class="categorySelect" required>
                <option value="" disabled selected hidden>カテゴリを選択</option>
                <option value="literature">文学・評論</option>
                <option value="social">社会・政治</option>
                <option value="history">歴史・地理</option>
                <option value="business">ビジネス・経済</option>
                <option value="science">科学・テクノロジー</option>
                <option value="medical">医学・薬学</option>
                <option value="it">コンピュータ・IT</option>
                <option value="design">建築・デザイン</option>
                <option value="hobby">趣味・実用</option>
                <option value="sports">スポーツ</option>
                <option value="certification">資格・検定</option>
                <option value="lifestyle">暮らし・健康</option>
            </select>
        </div>
          <div class="price-input-block">
            <h4 class="create-price-heading">価格</h4>
            <div class="price-input-wrapper">
              <input type="number" id="priceInput" name="price" class="create-price-input" min="0" placeholder="値段を入力してください">
              <span class="price-currency">円</span>
            </div>
          </div>
          <div class="file-upload-block">
            <h4 class="create-file-heading">表紙画像</h4>
            <div class="file-upload-wrapper">
              <input type="file" id="fileUpload" name="file" class="create-file-upload" accept=".pdf,.png,.jpg,.jpeg,.gif,.bmp,.tiff,.webp,.svg">
              <div id="imagePreview" class="image-preview-container">
                <img id="preview" src="" alt="プレビュー" style="display: none;">
                <div id="dropZone" class="drop-zone">
                  <i class="fa-solid fa-cloud-arrow-up"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <script>
    // 編集要素の取得
    const titleInput = document.getElementById('titleInput');
    const contentInput = document.getElementById('contentInput');

    // 入力フィールドを編集可能な領域に変換する
    function makeEditable(element) {
        const editableDiv = document.createElement('div');
        editableDiv.contentEditable = true;
        editableDiv.className = element.className;
        editableDiv.style.minHeight = element.offsetHeight + 'px';
        editableDiv.style.width = '100%';
        editableDiv.style.border = '1px solid #ccc';
        editableDiv.style.padding = '8px';
        editableDiv.innerHTML = element.value;

        element.parentNode.insertBefore(editableDiv, element);
        element.style.display = 'none';

        // 元の入力フィールドに内容を同期させる
        editableDiv.addEventListener('input', () => {
            element.value = editableDiv.innerHTML;
        });

        return editableDiv;
    }

    // 編集可能コンテンツ
    const editableTitleDiv = makeEditable(titleInput);
    const editableContentDiv = makeEditable(contentInput);

    // formatDoc
    function formatDoc(command, value = null) {
        document.execCommand(command, false, value);
    }


    // 色選択
    function updateColorValue(color) {
      document.getElementById('hexValue').textContent = color.toUpperCase();
      document.getElementById('swatch').style.backgroundColor = color;
      applyStyleToSelection('color', color); 
    };

    document.getElementById('colorPicker').addEventListener('input', function(e) {
      updateColorValue(e.target.value);
    });

    updateColorValue('#ff0000');

    document.getElementById('wf-form-Create-Form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const titleContent = document.getElementById('titleInput').innerHTML;
      const textContent = document.getElementById('contentInput').innerHTML;
      
      console.log('Title:', titleContent);
      console.log('Content:', textContent);
    });

    function updateColorValue(color) {
      document.getElementById('hexValue').textContent = color.toUpperCase();
      document.getElementById('swatch').style.backgroundColor = color;
      document.execCommand('foreColor', false, color);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const editableTitleDiv = document.querySelector('[contenteditable="true"]');
        const editableContentDiv = document.querySelector('div.textarea[contenteditable="true"]');

        [editableTitleDiv, editableContentDiv].forEach(element => {
            if (element) {
                element.addEventListener('focus', function() {
                    this.setAttribute('data-focused', 'true');
                });
                
                element.addEventListener('blur', function() {
                    this.removeAttribute('data-focused');
                });
            }
        });
    });


    // フォントサイズ
    let size = 1; // 初期フォントサイズ
    const sizeInput = document.getElementById('sizeInput');
    const buttons = document.querySelectorAll('.fontsize-btn');
    
    // ボタンクリック時のフォントサイズ調整
    buttons[0].addEventListener('click', () => adjustFontSize(-0.1)); // フォントサイズを小さくする
    buttons[1].addEventListener('click', () => adjustFontSize(0.1));  // フォントサイズを大きくする

    // 入力からフォントサイズを更新
    sizeInput.addEventListener('input', function() {
        let value = parseFloat(this.value);
        if (isNaN(value)) {
            value = 1;
        }
        // 限界範囲
        if (value < 0.5) value = 0.5;
        if (value > 5) value = 5;

        size = value;
        updateDisplay();
    });

    // フォントサイズ調整機能
    function adjustFontSize(delta) {
        const selection = document.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const selectedText = range.toString();

            if (selectedText) {
                const span = document.createElement('span');
                span.style.fontSize = `${size + delta}rem`;
                span.textContent = selectedText;

                range.deleteContents();
                range.insertNode(span);

                size = Math.max(0.5, Math.min(size + delta, 5));
                updateDisplay();
            }
        }
    }

    // アップデート表示機能
    function updateDisplay() {
        const displayValue = size === Math.floor(size) ? Math.floor(size) : size.toFixed(1);
        sizeInput.value = displayValue;
    }
    
    

    // 挿入リスト
    function insertList(command) {
        formatDoc(command);
    }
    
    // チェックボックス
    function insertCheckbox() {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const text = range.toString();
            const div = document.createElement('div');
            div.innerHTML = `<input type="checkbox"> ${text}`;
            range.deleteContents();
            range.insertNode(div);
        }
    }

    // 画像プレビュー機能
    document.addEventListener('DOMContentLoaded', function() {
      const fileUpload = document.getElementById('fileUpload');
      const preview = document.getElementById('preview');
      const dropZone = document.getElementById('dropZone');
      const previewContainer = document.getElementById('imagePreview');

      // ファイルの選択
      fileUpload.addEventListener('change', handleFileSelect);

      // ドラッグ＆ドロップ処理
      previewContainer.addEventListener('dragover', handleDragOver);
      previewContainer.addEventListener('drop', handleDrop);

      function handleFileSelect(e) {
        const file = e.target.files[0];
        for_flask = file.name;
        displayPreview(file);
      }

      function handleDragOver(e) {
        e.preventDefault();
        e.stopPropagation();
        previewContainer.style.borderColor = '#2196f3';
      }

      function handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();
        previewContainer.style.borderColor = '#ccc';
        
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          fileUpload.files = e.dataTransfer.files;
          displayPreview(file);
        }
      }

      function displayPreview(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // 圧縮画像
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 最大サイズの設定
                    const MAX_WIDTH = 800;
                    const MAX_HEIGHT = 800;
                    
                    let width = img.width;
                    let height = img.height;
                    
                    // スケーリング計算
                    if (width > height) {
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                    } else {
                        if (height > MAX_HEIGHT) {
                            width *= MAX_HEIGHT / height;
                            height = MAX_HEIGHT;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // 圧縮された画像を描く
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // より小さなJPEGフォーマットに変換
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    
                    preview.src = compressedDataUrl;
                    preview.style.display = 'block';
                    dropZone.style.display = 'none';
                };
                img.src = e.target.result;
            };
            
            reader.readAsDataURL(file);
        } else {
            alert('画像ファイルを選択してください。');
        }
      }

      // プレビューエリアをクリックすると、ファイル選択
      dropZone.addEventListener('click', function() {
        fileUpload.click();
      });
    });

    // JSでデータを収集して、flaskに送る
    document.getElementById('wf-form-Create-Form').onsubmit = function(e) {
      e.preventDefault();
      
      const title = editableTitleDiv.innerHTML;
      const content = editableContentDiv.innerHTML;
      const category = document.getElementById('categorySelect').value;
      const price = document.getElementById('priceInput').value;
      const coverImagePath = for_flask;
      const Image_data = document.getElementById('fileUpload').name;
  
      console.log('Form data:', {
          title,
          content,
          category,
          price,
          coverImagePath,
          Image_data
      });
  
      // 表单验证
      if (!title.trim()) {
          alert('タイトルを入力してください');
          return;
      }
  
      if (!content.trim()) {
          alert('内容を入力してください');
          return;
      }
  
      if (!category) {
          alert('カテゴリを選択してください');
          return;
      }
  
      if (!price) {
          alert('価格を入力してください');
          return;
      }
  
      if (!coverImagePath || coverImagePath === 'data:,') {
          alert('表紙画像をアップロードしてください');
          return;
      }
  
      const formData = {
          title: title.trim(),
          content: content.trim(),
          category: category,
          price: price,
          cover_image_path: coverImagePath
      };
  
      console.log('Sending data:', formData);
  
      fetch('/submit_create', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
      })
      .then(response => response.json())
      .then(data => {
          console.log('Server response:', data);
          if (data.message === '成功') {
              alert('投稿が完了しました！');
              window.location.href = '/';
          } else {
              alert('エラー：' + data.message);
          }
      })
      .catch(error => {
          console.error('Error:', error);
          alert('エラーが発生しました。もう一度お試しください。');
      });
    };
  </script>

  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=670b6ec91824c1500bdac7a2" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/webflow.js') }}" type="text/javascript"></script>

</body>
</html>