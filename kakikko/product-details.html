<!DOCTYPE html>
<html data-wf-page="670b752701de0ce1386810ba" data-wf-site="670b6ec91824c1500bdac7a2">
<head>
  <meta charset="utf-8">
  <title>product details</title>
  <meta content="product details" property="og:title">
  <meta content="product details" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="{{ url_for('static', filename='css/normalize.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/webflow.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/kakikko2.webflow.css') }}" rel="stylesheet" type="text/css">
  <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Noto Sans JP:regular,500,600,700,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="{{ url_for('static', filename='images/favicon.png') }}" rel="shortcut icon" type="image/x-icon">
  <link href="{{ url_for('static', filename='images/webclip.png') }}" rel="apple-touch-icon">
</head>
<body class="body">
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar w-nav">
    <div class="navbar-container">
      <a href="{{ url_for('index') }}" aria-current="page" class="w-nav-brand w--current">
        <img loading="lazy" src="{{ url_for('static', filename='images/Logo.png') }}" alt="LOGO">
      </a>
      <div class="navbar-menu-wrapper">
        <nav role="navigation" class="nav-menu w-nav-menu">
          <div data-delay="0" data-hover="false" class="w-dropdown">
            <div class="dropdown-toggle w-dropdown-toggle">
              <div class="bell-icon">
                <img src="{{ url_for('static', filename='images/bell.svg') }}" loading="lazy" alt="" class="navbar-icon">
              </div>
            </div>
            <nav class="dropdown-list w-dropdown-list">
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
              <a href="{{ url_for('notification') }}" class="dropdown-link w-inline-block"><img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="bell-author-image">
                <div>Username</div>
              </a>
            </nav>
          </div>
          <a href="{{ url_for('shoppingcart') }}" class="navbar-link shopping-cart w-nav-link"><img src="{{ url_for('static', filename='images/cart-shopping.svg') }}" loading="lazy" alt="" class="navbar-icon"></a>
          <a href="{{ url_for('login') }}" class="navbar-link w-nav-link"><img src="{{ url_for('static', filename='images/user-login.svg') }}" loading="lazy" alt="" class="navbar-icon"></a>
        </nav>
        <div class="menu-button w-nav-button">
          <div class="hamburger-menu w-icon-nav-menu"></div>
        </div>
      </div>
    </div>
  </div>
  <section class="hero-section">
    <div class="w-layout-blockcontainer hero-container w-container">
      <div class="sidenavbar">
        <div class="sindnavbar-header">
          <div class="sidenavbar-top">
            <a href="#" class="square is--hamburger w-inline-block">
              <img loading="lazy" src="{{ url_for('static', filename='images/hamburger.svg') }}" alt="" class="navbar__icon is--1">
              <img loading="lazy" src="{{ url_for('static', filename='images/x.svg') }}" alt="" class="navbar__icon is--2">
            </a>
          </div>
          <a href="{{ url_for('filter') }}" class="sidenavbar-search w-inline-block">
            <div class="square is--search"><img loading="lazy" src="{{ url_for('static', filename='images/search.svg') }}" alt="" class="navbar__icon is--search"></div>
            <div class="hide-text">
              <p class="sidenavbar-paragraph">検索</p>
            </div>
          </a>
          <div class="square is--line"></div>
        </div>
        <div class="nav__links">
          <a href="{{ url_for('index') }}" aria-current="page" class="sidenavbar-link w-inline-block w--current">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/home.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">ホーム</p>
            </div>
          </a>
          <a href="{{ url_for('create') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/plus.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">作成</p>
            </div>
          </a>
          <a href="{{ url_for('chatroom') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/chat.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">チャット</p>
            </div>
          </a>
          <a href="{{ url_for('purchase_history') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/history.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">購入履歴</p>
            </div>
          </a>
          <a href="{{ url_for('profile') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/user.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">プロフィール</p>
            </div>
          </a>
        </div>
        <div class="nav__footer">
          <a href="{{ url_for('confirmlogout') }}" class="sidenavbar-link w-inline-block">
            <div class="square is--link"><img loading="lazy" src="{{ url_for('static', filename='images/logout.svg') }}" alt="" class="sidenavbar-icon"></div>
            <div class="hide-text is--nav">
              <p class="sidenavbar-paragraph">ログアウト</p>
            </div>
          </a>
        </div>
      </div>

      <div class="product-block">
        <div class="product-left-block">
            <img src="{{ url_for('static', filename='images/users_images/' + book.book_cover_image) }}" loading="lazy" alt=" " class="product-image">
        </div>
        <div class="product-right-block">
            <div class="product-tag-block">
                <a href="{{ url_for('profileinfo', user_id=book.owner_id) }}" class="user-profile-wrapper">
                    {% if book.profile_image %}
                        <img src="{{ book.profile_image }}" loading="lazy" alt="" class="user-profile-image">
                    {% else %}
                        <img src="{{ url_for('static', filename='images/circle-user.svg') }}" loading="lazy" alt="" class="user-profile-image">
                    {% endif %}
                    <div class="user-name">{{ book.username }}</div>
                </a>
            </div>
            <h2 class="product-heading">{{ book.book_title | safe }}</h2>
            <div class="product-price-reviews-wrapper">
                <div class="product-price-text">￥{{ "%.2f"|format(book.book_price) }}</div>
                <div class="product-text-divider"></div>
                <div class="product-reviews-block">
                    <div class="product-rating-wrapper">
                        {% set rating = book.avg_rating|default(0)|float %}
                        {% for i in range(5) %}
                            <div class="product-header4_rating-icon">
                                <div class="icon-embed-xxsmall w-embed">
                                    {% if i < rating|int %}
                                        {# 完整星星 #}
                                        <svg width="100%" height="100%" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M0.201432 8.35425C0.0324796 8.23123 -0.0397528 8.01452 0.021606 7.81473L0.101529 7.56496C0.159961 7.36756 0.335635 7.22781 0.541103 7.21527L6.92493 6.70573L9.37256 0.821007C9.45466 0.614853 9.66074 0.485543 9.88206 0.501294H10.1418C10.3505 0.496866 10.539 0.62523 10.6114 0.821007L13.069 6.70573L19.4528 7.21527C19.6583 7.22781 19.8339 7.36756 19.8924 7.56496L19.9723 7.81473C20.0403 8.00821 19.9805 8.22355 19.8224 8.35425L15.0071 12.4905L16.4857 18.695C16.5344 18.8936 16.4596 19.1021 16.2959 19.2245L16.0061 19.3843C15.8371 19.4986 15.6157 19.4986 15.4467 19.3843L10.0119 16.0873L4.54723 19.4143C4.37823 19.5286 4.15676 19.5286 3.98777 19.4143L3.76798 19.2645C3.60419 19.142 3.52945 18.9335 3.57816 18.7349L5.01677 12.4905L0.201432 8.35425Z" fill="CurrentColor"></path>
                                        </svg>
                                    {% elif i == rating|int and (rating % 1) > 0 %}
                                        {# 半星 #}
                                        <svg width="100%" height="100%" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M19.8928 7.56999L19.9725 7.81999C20.0381 8.00868 19.9829 8.21839 19.8329 8.34999L14.9863 12.5L16.4223 18.72C16.4709 18.9188 16.3963 19.1275 16.2328 19.25L16.0134 19.4C15.9282 19.467 15.8225 19.5023 15.7143 19.5C15.6229 19.5019 15.533 19.4776 15.455 19.43L9.99999 16.1L4.57492 19.43C4.49692 19.4776 4.40695 19.5019 4.31563 19.5C4.20738 19.5023 4.10167 19.467 4.01646 19.4L3.76714 19.25C3.60364 19.1275 3.52904 18.9188 3.57766 18.72L5.01371 12.5L0.177024 8.35999C0.0192942 8.22917 -0.0404113 8.01364 0.027436 7.81999L0.137134 7.56999C0.195462 7.37241 0.370823 7.23254 0.575926 7.21999L6.94839 6.70999L9.39166 0.819989C9.46995 0.624384 9.66017 0.497222 9.87035 0.499989H10.1296C10.3379 0.495557 10.5261 0.624037 10.5983 0.819989L13.0815 6.70999L19.454 7.21999C19.6591 7.23254 19.8344 7.37241 19.8928 7.56999ZM14.1087 16.56L12.9918 11.88L16.6517 8.74999L11.8549 8.36999L9.99999 3.90999V14.05L14.1087 16.56Z" fill="CurrentColor"></path>
                                        </svg>
                                    {% else %}
                                        {# 空星 #}
                                        <svg width="100%" height="100%" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.39166 0.819989C9.46995 0.624384 9.66017 0.497222 9.87035 0.499989H10.1296C10.3379 0.495557 10.5261 0.624037 10.5983 0.819989L13.0815 6.70999L19.454 7.21999C19.6591 7.23254 19.8344 7.37241 19.8928 7.56999L19.9725 7.81999C20.0381 8.00868 19.9829 8.21839 19.8329 8.34999L14.9863 12.5L16.4223 18.72C16.4709 18.9188 16.3963 19.1275 16.2328 19.25L16.0134 19.4C15.9282 19.467 15.8225 19.5023 15.7143 19.5C15.6229 19.5019 15.533 19.4776 15.455 19.43L9.99999 16.1L4.57492 19.43C4.49692 19.4776 4.40695 19.5019 4.31563 19.5C4.20738 19.5023 4.10167 19.467 4.01646 19.4L3.76714 19.25C3.60364 19.1275 3.52904 18.9188 3.57766 18.72L5.01371 12.5L0.177024 8.35999C0.0192942 8.22917 -0.0404113 8.01364 0.027436 7.81999L0.137134 7.56999C0.195462 7.37241 0.370823 7.23254 0.575926 7.21999L6.94839 6.70999L9.39166 0.819989ZM16.6517 8.74999L11.8549 8.36999L9.99999 3.90999L8.14509 8.36999L3.3483 8.74999L7.00822 11.88L5.88132 16.56L9.99999 14.05L14.1087 16.56L12.9918 11.88L16.6517 8.74999Z" fill="CurrentColor"></path>
                                        </svg>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="product-reviews-text">({{ "%.1f"|format(book.avg_rating|default(0)) }}) • {{ book.review_count|default(0) }} レビュー</div>
                </div>
            </div>
            <div class="product-form-block w-form">
              <form id="wf-form-Produt-Form" name="wf-form-Produt-Form" data-name="Produt Form" method="get" class="product-form">
                  {% if not is_owner and not is_purchased %}
                  <div class="product-form-wrapper">
                      <a id="w-node-f7fc365a-1696-4f30-9a03-c4e98e79678a-386810ba" onclick="addToCart()" href="#" class="add-to-cart-btn w-button">カートに入れる</a>
                      <!-- 数量選択（非表示中） -->
                      <!-- <input class="form_input is-quantity-input w-node-f7fc365a-1696-4f30-9a03-c4e98e79678c-386810ba w-input" 
                             maxlength="256" name="Quantity" data-name="Quantity" placeholder="1" type="number" min="1" id="Quantity"> -->
                  </div>
                  {% endif %}
                  {% if is_owner or is_purchased %}
                  <div class="products1-actions-wrap" style="margin-top: 60px;">
                    <a href="{{ url_for('read', book_id=book.book_id) }}" class="button-secondary is-buy-now-button w-button">読む</a>
                  {% else %}
                  <div class="products1-actions-wrap">
                    <a href="#" onclick="sendData()" class="button-secondary is-buy-now-button w-button">今すぐ買う</a>
                  {% endif %}
                    <a href="#" class="link-block w-inline-block">
                      <div class="text-14 text-14-30" id="heart-icon">
                          <i class="fa-solid fa-heart"></i>
                      </div>
                    </a>
                  </div>
              </form>
            </div>
        </div>
      </div>
    </div>
  </section>
  <!-- コメントの表示と投稿セクション -->
  <section class="section">
    <div class="w-layout-blockcontainer container w-container">
      <div class="comment-block">
        <!-- コメントの表示部分 -->
        <div class="comment-window">
          {% for comment in comments %}
          <div class="comment-blocks">
            <div class="left-block">
              <img src="{{ url_for('static', filename='images/circle-user.svg') }}" alt="">
            </div>
            <div class="right-block">
              <div class="right-block-top">
                <div class="comment-username">{{comment.username}}</div>
                <div class="comment-date">{{comment.created_at}}</div>
              </div>
              <div class="comment-body">{{comment.comment}}</div>
            </div>
          </div>
          {% endfor %}
        </div>
        <!-- コメント投稿部分 -->
        <div data-ms-post="item" class="comment-row">
          <div class="comment-image-wrap"><img data-ms-post="ownerProfileImage" loading="lazy" alt="" src="{{ url_for('static', filename='images/circle-user.svg') }}" class="comment-image"></div>
          <div class="comment-content">
            <div class="comment-hover">
              <div class="comment-name-row">
                <div class="comment-inline-block">
                  <div class="commenter-name">
                    <div data-ms-post-creator="first-name">Username</div>
                  </div>
                </div>
              </div>
              <div data-ms-post="content" class="comment-text">コメント</div>
              <div data-ms-post-edit="section" class="comment-edit-section">
                <div class="comment-no-margin w-form">
                  <form id="wf-form-Edit-Comment-Form" name="wf-form-Edit-Comment-Form" data-name="Edit Comment Form" method="get" data-ms-post-edit="form" data-wf-page-id="670b752701de0ce1386810ba" data-wf-element-id="b535171e-a3ac-0a08-c6c4-e5b838f35653"><textarea class="comment-input w-input" maxlength="5000" name="Edit-Comment" data-name="Edit Comment" data-ms-post-edit="content" placeholder="コメントを入力" id="Edit-Comment"></textarea>
                    <div class="comment-form-button-row">
                      <div class="comment-delete-wrap">
                        <a href="#" class="comment-delete-btn w-button">削除1</a>
                      </div>
                      <a data-ms-post-edit="cancel" href="#" class="comment-btn is-cancel w-button">キャンセル</a>
                      <button type="submit" id="Comment_Submission" class="comment-btn w-button">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- JavaScript -->
  <script>
    //ショッピングカートの処理
    function addToCart() {
      event.preventDefault();
      const bookId = '{{ book.book_id }}';
      console.log("bookId" + bookId)
      
      fetch('/addToCart', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
              productID: bookId,
          })
      })
      .then(response => {
          if (response.redirected) {
              window.location.href = response.url;
          }
      })
      .catch(error => {
          console.error('Error:', error);
          alert('エラーが発生しました。');
      });
  }


    //購入の処理
    function sendData() {
        event.preventDefault();
        const sellerID = '{{ book.owner_id }}';
        const bookId = '{{ book.book_id }}';
        console.log("sellerID" + sellerID)
        console.log("bookId" + bookId)
        
        fetch('/submit_product-details', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                productID: bookId,
                sellerID: sellerID,
            })
        })
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('エラーが発生しました。');
        });
    }
    
    //コメント投稿の処理
    document.getElementById("Comment_Submission").addEventListener("click",function(){
      console.log("コメント投稿機能");
      event.preventDefault();
      const maintxt = document.getElementById('Edit-Comment').value;
      const bookId = '{{ book.book_id }}';
      console.log("maintxt : " + maintxt);
      console.log("bookId : " + bookId);
      
      fetch('/submit_product-comment', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
              productID: bookId,
              maintxt: maintxt,
          })
      })
      .then(response => {
          if (response.redirected) {
              window.location.href = response.url;
          }
      })
      .catch(error => {
          console.error('Error:', error);
          alert('エラーが発生しました。');
      });
    });

      
    // お気に入り機能
    document.getElementById('heart-icon').addEventListener('click', function(e) {
        e.preventDefault();
        this.classList.toggle('active');
    });
  </script>
  
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=670b6ec91824c1500bdac7a2" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/webflow.js') }}" type="text/javascript"></script>
</body>
</html>